EXES[] =
  cinclude
  dynregion
  flatlist
  foo
  hello
  histogram
  md5
  multimethod
  patterns
  rc
  refcnt_test
  scheme
  scheme-2
  streambufftest
  subset
  testaqualsuccess
  testasm
  testbget
  test_currgn
  test_getopt
  test_large_vc_terms
  test_regions
  unique_patterns
  zeroterm

foreach (exe, $(EXES)):
  OBJECTS = $(exe).o

  switch $(exe):
  case foo:
    OBJECTS += foo_tab.o
    export
  case streambufftest:
    OBJECTS += streambuff.o
    export
  case md5:
    OBJECTS += md5driver.o
    export

  $(exe): $(OBJECTS) $(rootdir)/library/stdlib/libcyc.so
    cc -m32 $(OBJECTS) -o $@ $(LDFLAGS) -lcyc -lm

  check: $(exe)
    if $(file-exists $(exe)_input):
      $< < $(exe)_input
    elseif $(file-exists $(exe).txt):
      $< $(exe).txt
    else
      $< $<
